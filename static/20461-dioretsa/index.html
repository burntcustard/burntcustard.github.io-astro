<body style=margin:0;cursor:none><canvas><script>let t,i,s={};function h(t,...i){s[t]&&s[t].map(t=>t(...i))}function e(){return i}const r=()=>{};function n(){let i=t;e().clearRect(0,0,i.width,i.height)}function a({t:t=60,i:i=1,s:s,h:e}={}){let a,o,l,c,u,f=0,d=1e3/t,x=1/t,M=i?n:r;function p(){if(o=requestAnimationFrame(p),l=performance.now(),c=l-a,a=l,1e3>=c){for(h("tick"),f+=c;f>=d;)u.s(x),f-=d;M(),u.h()}}return u={s:s,h:e,o:1,start(){a=performance.now(),this.o=0,requestAnimationFrame(p)},stop(){this.o=1,cancelAnimationFrame(o)}}}class o{constructor(t,i){this.u=t||0,this.M=i||0}add(t,i){return l(this.x+(t.x||0)*(i||1),this.y+(t.y||0)*(i||1))}p(t,i,s,h){this.g=1,this._=t,this.m=i,this.v=s,this.R=h}get x(){return this.u}get y(){return this.M}set x(t){this.u=this.g?Math.min(Math.max(this._,t),this.v):t}set y(t){this.M=this.g?Math.min(Math.max(this.m,t),this.R):t}}function l(t,i){return new o(t,i)}l.prototype=o.prototype,l.A=o;let c={},u={},f={};function d(t,i){t.map(t=>c[t]=i)}function x(t){if(u[t])return u[t]=0,1}function M(t){return!!f[t]}function p(t){t.k=t.k||1,t.width=720*t.k,t.scale=window.innerWidth/t.width,t.height=window.innerHeight/t.scale,t.canvas.width=window.innerWidth,t.canvas.height=window.innerHeight}let w=[];function g(t,i){return!!window.gamepads[t].S[i]}function _(t,i){return window.gamepads[t].axes[i]}function m(t){w=navigator.getGamepads(),Array.prototype.forEach.call(w,t=>{if(t){var i=window.gamepads[t.index];t.buttons.forEach((t,s)=>{let h=function(t,i){return Object.keys(t).find(s=>t[s]===i)}(i.B,s);t.pressed?h&&(i.S[h]=1):h&&(i.S[h]=0)}),i.axes.x=0,i.axes.y=0,t.axes.forEach((t,s)=>{1&s?i.axes.y+=t:i.axes.x+=t})}})}const v=",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,5 0 5 9M5 12 5 14,,,,1 5 1 2 4 2 4 5ZM2 15 9 0M7 10 10 10 10 13 7 13Z,,,8 0 4 0 4 14 8 14,3 0 7 0 7 14 3 14,,,6 12 4 15,3 6 8 6,,2 15 8 0,6 0 11 7 6 14 1 7ZM6 6 6 8,2 4 6 1 6 14,0 4 6 0 10 4 1 13 11 13,2 0 10 3 6 7 10 11 2 13,6 1 1 11 10 11M6 7 6 15,10 1 3 1 1 7 10 7 8 13 0 13,11 1 6 1 1 13 10 13 10 7 4 7,3 1 11 1 6 14,2 4 6 0 10 4 2 10 6 14 10 10Z,1 13 6 13 11 1 2 1 2 7 9 7,,,,,2 4 10 8 2 12,,,1 14 5 2 10 14M3 9 8 9,3 13 3 0 10 3 4 7 10 10Z,9 1 5 1 3 3 3 11 5 13 9 13,3 13 3 1 7 1 9 4 9 10 7 13Z,9 13 3 13 3 1 9 1M3 7 7 7,3 14 3 1 9 1M3 7 7 7,7 1 2 4 2 11 6 13 9 9 5 9,2 14 2 0M9 14 9 0M2 8 9 8,3 13 9 13M3 1 9 1M6 13 6 1,2 11 6 14 9 11 9 1 4 1,3 14 3 0M9 2 4 8 9 14,4 0 4 13 9 13,2 14 2 2 6 6 10 2 10 14,2 14 2 2 9 12 9 0,6 0 11 7 6 14 1 7Z,3 14 3 1 10 1 9 7 3 7,5 1 10 7 5 13 0 7ZM9 13 5 8,3 14 3 1 10 1 9 7 4 7 10 13,10 1 3 1 1 7 10 7 8 13 0 13,6 14 6 1M2 1 10 1,3 0 3 12 6 14 9 12 9 0,3 1 3 7 6 13 9 7 9 1,1 0 3 12 6 5 9 12 11 0,2 0 10 14M10 0 2 14,6 14 6 8M2 0 6 8 10 0,1 1 9 1 2 13 10 13".split(",").map(t=>new Path2D("M"+t));function b(t){[...t.text.toString().toUpperCase()].forEach((i,s)=>{var h=v[i.charCodeAt(0)];s&&t.O.translate(13,0),h&&t.O.stroke(h)})}function z(t){let i=t.k||1,s=yAlign=0;t.O.save(),t.O.scale(t.scale,t.scale),t.j&&(yAlign=-6.5*i,s=6.5*-t.text.toString().length*i),t.C&&(yAlign=-17*i),t.P&&(s=13*-t.text.toString().length*i),t.O.translate(t.x+s,t.y+yAlign),t.O.scale(i,i),t.O.strokeStyle=t.q||"#fff",t.O.lineWidth=1.5,b(t),t.O.restore()}class R{constructor(t){this.O=t.O,this.q=t.q||"#fff",this.Z=[],this.x=t.x,this.y=t.y,t.Z.forEach((t,i)=>{this.Z.push({text:t.text,y:30*i})}),this.Z[0].F=1,this.F=0}next(){++this.F===this.Z.length&&(this.F=0),this.Z.forEach((t,i)=>{t.F=i===this.F?1:0})}T(){0>--this.F&&(this.F=this.Z.length-1),this.Z.forEach((t,i)=>{t.F=i===this.F?1:0})}h(t){this.Z.forEach(i=>{this.O.save(),this.O.scale(t,t),this.O.translate(this.x,this.y+i.y),this.O.lineWidth=1.5,i.F?(this.O.strokeStyle=this.q,b({text:"> "+i.text,O:this.O})):(this.O.strokeStyle=this.q+"9",b({text:"  "+i.text,O:this.O})),this.O.restore()})}}class A{constructor(t){this.init(t)}init(t={}){let{x:i,y:s,dx:h,dy:r,L:n,D:a}=t;this.U=l(i,s),this.I=l(h,r),this.J=l(n,a),this.N=0,this.X=1/0,this.O=e(),this.q=t.q||"#fff";for(let i in t)this[i]=t[i]}get x(){return this.U.x}get y(){return this.U.y}get dx(){return this.I.x}get dy(){return this.I.y}get L(){return this.J.x}get D(){return this.J.y}set x(t){this.U.x=t}set y(t){this.U.y=t}set dx(t){this.I.x=t}set dy(t){this.I.y=t}set L(t){this.J.x=t}set D(t){this.J.y=t}H(){return this.X>0}}function k(t){return new A(t)}function S(t){return t*Math.PI/180}function B(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function O(t,i){let s=Object.keys(t),h=Object.values(t).indexOf(i);return 0>--h?t[s[s.length-1]]:t[s[h]]}function j(t,i){let s=Object.keys(t),h=Object.values(t).indexOf(i);return h++==s.length-1?t[s[0]]:t[s[h]]}function C(t,i){return t.some(t=>t!==i&&t.q===i.q)}function P(t,i){const s=Math.cos(S(i.N)),h=Math.sin(S(i.N));let e=(t[0]+t[2])/2,r=(t[1]+t[3])/2,n=k({type:4,x:i.x+(e*s-r*h),y:i.y+(r*s+e*h),N:i.N,q:i.q,p1:{x:t[0]-e,y:t[1]-r},p2:{x:t[2]-e,y:t[3]-r},V:i.game.K.G(i.x+(e*s-r*h),i.y+(r*s+e*h),[[t[0]-e,t[1]-r],[t[2]-e,t[3]-r]]),dx:i.dx+Math.random()-.5,dy:i.dy+Math.random()-.5,X:3===i.type?120+60*Math.random():60*Math.random(),W:20*Math.random()-10,s(t){this.dx*=.999,this.dy*=.999,this.N+=this.W,this.U=this.U.add(this.I,t),this.X--,this.V.x=this.x,this.V.y=this.y,this.V.Y=S(this.N)},h(t){this.O.save(),this.O.scale(t,t),this.O.translate(this.x,this.y),this.O.rotate(S(this.N)),this.O.beginPath(),this.O.strokeStyle=this.q,this.O.moveTo(this.p1.x,this.p1.y),this.O.lineTo(this.p2.x,this.p2.y),this.O.stroke(),this.O.restore()}});n.V.$=n,i.game.tt.push(n)}function q(t){for(var i=Math.round(4+2*Math.random()+Math.sqrt(t)),s=[],h=1;i>=h;h++){var e=1+.1*Math.random(),r=Math.cos(2*Math.PI*h/i)*t*e,n=Math.sin(2*Math.PI*h/i)*t*e;h>1&&s[s.length-1].push(r,n),s.push([r,n]),h===i&&s[s.length-1].push(s[0][0],s[0][1])}return s}function Z(t){let i=k({type:1,x:t.x,y:t.y,dx:void 0!==t.dx?t.dx:Math.random()-.5,dy:void 0!==t.dy?t.dy:Math.random()-.5,it:t.it,st:t.st||Math.PI*t.it*t.it,ht:q(t.it),game:t.game,W:t.W||0,N:360*Math.random(),h(t){this.O.save(),this.O.scale(t,t),this.O.translate(this.x,this.y),this.O.rotate(S(this.N)),this.O.beginPath(),this.O.strokeStyle="#fff",this.ht.forEach((t,i)=>{i||this.O.moveTo(t[0],t[1]),this.O.lineTo(t[2],t[3])}),this.O.closePath(),this.O.stroke(),this.O.restore()},s(t){this.N+=this.W,this.I=this.I.add(this.J,t),this.U=this.U.add(this.I,t),this.V&&(this.V.x=this.x,this.V.y=this.y,this.V.Y=S(this.N))},et(){this.X=0,this.ht.forEach(t=>{P(t,this)})}});t.rt||(i.it>12?(i.nt=[],i.ht.forEach((t,s)=>{i.nt.push([t[0],t[1]])}),i.V=i.game.K.G(i.x,i.y,i.nt)):i.V=i.game.K.ot(i.x,i.y,i.it),i.V.$=i),t.game.tt.push(i),t.game.lt.push(i)}k.prototype=A.prototype,k.A=A;const F=[{ct:7,st:3,ut:9,ft:3,dt:6,ht:{body:[[-6,-5,7,0],[7,0,-6,5],[-6,5,-4,0],[-4,0,-6,-5]],ut:[[-5,-2,-8,0],[-8,0,-5,2]],V:[[-6,-5],[8,0],[-6,5]]}},{ct:8,st:4,ut:8,ft:5,dt:8,ht:{body:[[-5,-2,1,-2],[1,-2,2,-1],[2,-1,2,1],[2,1,1,2],[1,2,-5,2],[-5,2,-6,1],[-6,1,-6,-1],[-6,-1,-5,2]],xt:[[-9,-3,-5,-8],[-5,-8,1,-8],[1,-8,9,-3],[9,-3,-9,-3],[-5,-8,-3,-2],[1,-8,-1,-2],[-9,3,-5,8],[-5,8,1,8],[1,8,9,3],[9,3,-9,3],[-5,8,-3,2],[1,8,-1,2]],ut:[[-7,-1,-8,0],[-8,0,-7,1]],V:[[-9,-3],[-5,-8],[1,-8],[9,-3],[9,3],[1,8],[-5,8],[-9,3]]}},{ct:4,st:9,ut:9,ft:8,dt:4,ht:{body:[[-4,-9,-1,-9],[-1,-9,5,-3],[5,-3,5,3],[5,3,-1,9],[-1,9,-4,9],[-4,9,-4,-9]],xt:[[-1,-9,-4,-5],[-4,-5,5,-3],[5,-3,2,0],[-4,-5,2,0],[2,0,-4,5],[2,0,5,3],[-4,5,5,3],[-4,5,-1,9]],ut:[[-4,-3,-6,-2],[-6,-2,-4,-1],[-4,3,-6,2],[-6,2,-4,1]]}},{ct:6,st:4,ut:8,ft:4,dt:8,ht:{body:[[-6,-7,-2,-6],[-2,-6,2,-2],[2,-2,7,-2],[7,-2,9,0],[9,0,7,2],[7,2,2,2],[2,2,-2,6],[-2,6,-6,7],[-6,7,-3,2],[-3,2,-5,2],[-5,2,-5,-2],[-5,-2,-3,-2],[-3,-2,-6,-7]],xt:[[-4,-2,2,-2],[-4,2,2,2]],ut:[[-6,-1,-8,0],[-8,0,-6,1]],V:[[6,-2],[8,0],[6,2],[3,2],[-7,7],[-7,-7],[3,-2]]}}];function T(t,i,s,h=1,e=.1,r=0,n=0,a=0,o=0){let l=44100,c=Math.PI;s*=2*c/l,s*=1+i*(2*Math.random()-1),r*=1e3*c/l**2,e*=0|(h=h>0?l*(h>10?10:h)|0:1),a*=2*c/l,o*=c,i=[];for(var u=0,f=0,d=0;h>d;++d)i[d]=t*zv*Math.cos(u*s*Math.cos(f*a+o))*(e>d?d/e:1-(d-e)/(h-e)),u+=1+n*(2*Math.random()-1),f+=1+n*(2*Math.random()-1),s+=r;return t=zx.createBuffer(1,h,l),s=zx.createBufferSource(),t.getChannelData(0).set(i),s.buffer=t,s.connect(zx.destination),s.start(),s}zv=.5,zx=new AudioContext;const L={Mt:()=>T(.5,.1,1100,.9,0,0,4,0,.4),pt:()=>T(.2,.1,1100,.9,0,0,4,0,.4),yt:()=>T(.2,0,250,1,.7,0,0,38,.5),wt:()=>T(.4,0,1300,.1,.3,6.1,0,15.9,.88),gt:()=>T(.2,0,1e3,.2,.03,.1,.1,0,.86),_t:()=>T(.3,.1,68,1,.07,0,3.6,0,.7),vt:()=>T(1,.1,11,.9,.5,2.5,.9,.4,.88),bt:()=>T(.8,0,250,.1,.2,.1,0,11.6,.13),zt:()=>T(.2,.8,900,.1,.1,1.4,0,0,.7),Rt:()=>T(.3,0,1993,.3,.1,.1,0,0,.8),At:()=>T(.3,0,51,.1,.6,2,.3,19,1)};class D extends k.A{constructor(t){super(t),this.game=t.game;var i=JSON.parse(JSON.stringify(F[t.kt]));this.St=i,this.Bt=i.ft,this.Ot=0,this.ht={},this.ht.random=[],this.jt=[],this.zt=0,this.Ct=0,this.Pt=0,this.qt=5,this.type=3,this.N=360*Math.random(),this.W=t.W||0,this.Zt=i.Zt,this.Ft=4,this.ft=i.ft,this.st=i.st+11,this.it=7,this.Zt=.2,this.ut=i.ut+6,this.ct=(i.ct+11)/4,this.dt=(this.St.dt+6)/12,this.Tt=t.Tt,this.ht.body=i.ht.body||[],this.ht.xt=i.ht.xt||[],this.ht.ut=i.ht.ut||[],this.ht.V=i.ht.V||[],this.ht.Lt=this.ht.body.concat(this.ht.xt),t.Dt||(this.ht.V.length||(this.ht.V=[],this.ht.body.forEach(t=>{this.ht.V.push([t[0],t[1]])})),this.V=this.game.K.G(this.x,this.y,this.ht.V),this.V.scale=this.scale,this.V.$=this)}Ut(){this.V.remove(),this.It=1,this.Jt=0,this.V=this.game.K.ot(this.x,this.y,this.it+4),this.V.$=this}Nt(){this.V.remove(),this.It=0,this.V=this.game.K.G(this.x,this.y,this.ht.V),this.V.scale=this.scale,this.V.$=this}wt(){if(this.Ot<this.Zt||1>this.Bt||this.Pt)return 0;const t=Math.cos(S(this.N)),i=Math.sin(S(this.N));L.wt(),this.Ot=0,this.Bt--,this.Tt.Xt++,this.dx-=t/(this.st/2),this.dy-=i/(this.st/2),function(t){const i=Math.cos(S(t.N)),s=Math.sin(S(t.N));let h=k({type:0,parent:t,x:t.x+i*t.it,y:t.y+s*t.it,dx:t.dx+8*i,dy:t.dy+8*s,X:50,q:t.q,V:t.game.K.ot(t.x,t.y,1),s(t){this.I=this.I.add(this.J,t),this.U=this.U.add(this.I,t),this.X--,this.V.x=this.x,this.V.y=this.y},h(t){this.O.save(),this.O.scale(t,t),this.O.translate(this.x,this.y),this.O.fillStyle=this.q,this.O.beginPath(),this.O.arc(0,0,1,0,2*Math.PI),this.O.fill(),this.O.restore()}});h.V.$=h,h.$=t,t.game.tt.push(h)}(this)}Ht(){this.N-=this.ct}Vt(){this.N+=this.ct}Et(){if(this.Pt)return 0;const t=Math.cos(S(this.N)),i=Math.sin(S(this.N));.05>Math.random()&&L._t(),this.L=.1*t*this.ut/this.st,this.D=.1*i*this.ut/this.st}Gt(){this.L=this.D=0}vt(){if(this.Ct<=this.Ft)return 0;L.vt(),this.Ct=0,this.Pt=this.jt.length}Kt(){if(this.N>360&&(this.N-=360),0>this.N&&(this.N+=360),this.Jt&&(this.Jt--,0===this.Jt&&(L.bt(),this.Nt())),this.Ct<this.Ft&&(this.Ct+=1/60),this.Ot+=1/60,this.Qt>0?this.Qt-=1/60:this.Qt=0,this.zt>0&&(this.zt-=1/60,Math.floor(12*this.zt)%2&&L.zt(),this.zt>0||(this.dt=(this.St.dt+6)/12,this.zt=0)),this.Pt>0)return this.Pt=this.Pt-this.qt,this.jt[this.Pt]?(this.Pt<this.jt.length&&(this.x=this.jt[this.Pt].x,this.y=this.jt[this.Pt].y),0===this.Pt&&(this.dx*=.8,this.dy*=.8,this.Qt=.2,this.Bt=this.jt[0].ft,this.zt=this.jt[0].zt),1):(this.Pt=0,0);this.Bt<this.ft&&(this.Bt+=1/60*.5),this.I=this.I.add(this.J),function(t,i=10,s=3){const h=B(t);var[e,r]=[t.x,t.y];h>s?(e=e/h*s,r=r/h*s):(e=Math.abs(e)>.01?e*Math.min(.99,.83+i/99):0,r=Math.abs(r)>.01?r*Math.min(.99,.83+i/99):0),[t.x,t.y]=[e,r]}(this.I,this.st,this.dt),this.U=this.U.add(this.I),this.jt.push({x:this.x,y:this.y,ft:this.Bt,zt:this.zt}),this.jt.length>120&&this.jt.shift(),this.V.x=this.x,this.V.y=this.y,this.V.Y=S(this.N)}et(){this.Wt=1,this.Tt&&this.Tt.Yt++,L.Mt(),this.ht.Lt.forEach(t=>{P(t,this)})}$t(t,i,s){this.O.save(),this.O.scale(t,t),this.O.translate(i,s),this.O.rotate(S(this.N)),this.O.strokeStyle=this.q,this.O.scale(3,3),this.O.beginPath(),this.O.lineWidth=.8,this.O.moveTo(this.ht.body[0][0],this.ht.body[0][1]);for(var h=0;h<this.ht.body.length-1;h++)this.O.lineTo(this.ht.body[h][2],this.ht.body[h][3]);this.O.closePath(),this.ht.xt.forEach(t=>{this.O.moveTo(t[0],t[1]),this.O.lineTo(t[2],t[3])}),this.O.stroke(),this.O.restore()}ti(t){this.O.strokeStyle="#0ef";var i=.2*Math.PI/this.ft;for(let t=0;t<Math.floor(this.Bt);t++)this.O.beginPath(),this.O.arc(0,0,this.it+6,.8*Math.PI+i*t*2,Math.PI+(2*i-.05)-.2*Math.PI+i*t*2),this.O.stroke();this.Ct>this.Ft||(this.O.strokeStyle="#0ef9"),this.O.beginPath(),this.O.arc(0,0,this.it+6,-.2*Math.PI*1/this.Ft*this.Ct,.2*Math.PI/this.Ft*this.Ct),this.O.stroke()}h(t){if(this.O.save(),this.O.scale(t,t),this.O.translate(this.x,this.y),this.ti(t),this.O.rotate(S(this.N)),this.O.strokeStyle=this.q,this.Qt&&Math.floor(4*this.Qt+.1)%2&&(this.O.lineWidth=.5),this.zt&&(this.ii=this.ii||"",Math.floor(12*this.zt)%2&&(this.ii="hsl("+360*Math.random()+",100%,60%)"),this.O.strokeStyle=this.ii),this.O.beginPath(),this.Pt)this.si=this.si||1,1===this.si&&(this.ht.random=[],this.ht.Lt.forEach(t=>{this.ht.random.push([t[0]*Math.random(),t[1]*Math.random(),t[2]*Math.random(),t[3]*Math.random()])})),this.si=4>this.si?this.si+1:1,this.ht.random.forEach(t=>{this.O.moveTo(t[0],t[1]),this.O.lineTo(t[2],t[3])}),this.O.stroke();else{this.O.moveTo(this.ht.body[0][0],this.ht.body[0][1]);for(var i=0;i<this.ht.body.length-1;i++)this.O.lineTo(this.ht.body[i][2],this.ht.body[i][3]);this.O.closePath(),this.ht.xt.forEach(t=>{this.O.moveTo(t[0],t[1]),this.O.lineTo(t[2],t[3])}),(this.L||this.D)&&this.ht.ut.forEach((t,i)=>{i>0&&this.ht.ut[i-1][2]===t[0]&&this.ht.ut[i-1][3]===t[1]?this.O.lineTo(t[2],t[3]):(this.O.moveTo(t[0],t[1]),this.O.lineTo(t[2],t[3]))}),this.O.stroke(),1===this.It&&(this.O.beginPath(),this.O.arc(0,0,this.it+4,0,2*Math.PI),this.Jt&&Math.floor(this.Jt/15)%2&&(this.O.lineWidth=.5),this.O.strokeStyle="#fff",this.O.stroke())}this.O.restore()}}function U(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function I(t,i){return t.x*i.x+t.y*i.y}function J(t,i){return Math.abs(U({x:t.Lt.x-i.x,y:t.Lt.y-i.y}))}function N(t,i,s){let h=S(t.Lt.N)-(e={x:t.Lt.x-i.x,y:t.Lt.y-i.y},Math.atan2(e.y,e.x))+Math.PI;var e;return h=h%(2*Math.PI)-Math.PI,s&&(h>0?h-=Math.PI:h+=Math.PI),h}var X=(t,i)=>{switch(t){case"arrows":return{ut:()=>M("ArrowUp"),wt:()=>M(" "),left:()=>M("ArrowLeft"),right:()=>M("ArrowRight"),vt:()=>M("ArrowDown"),hi:()=>M("ArrowUp"),ei:()=>M("ArrowDown"),ri:()=>M(" "),back:()=>M("Escape")};case"wasd/zqsd":return{ut:()=>M("w")||M("z"),wt:()=>M("e"),left:()=>M("a")||M("q"),right:()=>M("d"),vt:()=>M("s"),hi:()=>M("w"),ei:()=>M("s"),ri:()=>M("e"),back:()=>M("x")};case"gamepad":return{ut:()=>g(i,"a"),wt:()=>g(i,"r"),left:()=>-.5>_(i,"x"),right:()=>_(i,"x")>.5,vt:()=>g(i,"l"),hi:()=>-.5>_(i,"y"),ei:()=>_(i,"y")>.5,ri:()=>g(i,"a"),back:()=>g(i,"b")}}};let H=0;class V{constructor(t){this.q=t.q,this.ni=t.ni,this.game=t.game,this.O=t.O,this.kt=t.kt,this.reset(),"ai"!==this.ni?("gamepad"===this.ni?(this.keys=X(this.ni,H++),this.ai="",t.ai.match(/2006|2007/)&&(this.ai="Joy Con"),t.ai.includes("Xbox")&&(this.ai="Xbox Controller"),t.ai.includes("(L)")&&(this.ai+=" (L)"),t.ai.includes("(R)")&&(this.ai+=" (R)")):this.ni&&(this.keys=X(this.ni)),this.oi={hi:15,ei:15,left:15,right:15,ri:15,back:15}):this.li=1}reset(){this.ci=0,this.Yt=0,this.li=0,this.ui=0,this.Xt=0,this.fi=0,this.di=0}xi(){this.Lt&&this.Lt.H&&!this.game.Mi&&(this.keys.vt()&&this.Lt.vt(),this.keys.ut()?this.Lt.Et():this.Lt.Gt(),this.keys.left()&&this.Lt.Ht(),this.keys.right()&&this.Lt.Vt(),this.keys.wt()&&this.Lt.wt())}s(){"ai"===this.ni?function(t){var i,s,h,e,r=game.pi[0].Lt,n=game.yi[0];if(t.Lt&&t.Lt.H&&!t.game.Mi&&!function(t){var i=0;return t.Lt.wi?0:t.Lt.Ct>t.Lt.Ft?(1>t.Lt.Bt&&t.Lt.jt[0].ft>=t.Lt.ft&&(i+=4),t.Lt.zt&&4>t.Lt.zt&&i++,60*Math.random()<i?(t.Lt.vt(),1):void 0):0}(t)){var a=0;game.lt.forEach((i,s)=>{var h=J(t,i);if(h<=i.it+40){var e=N(t,i);t.Lt.zt>1&&0===s?(a=1,t.Lt.Et(),-1.8>e?t.Lt.Vt():e>1.8&&t.Lt.Ht()):0===s&&h>25?(a=1,t.Lt.Et(),-Math.PI/2>e?t.Lt.Vt():e>Math.PI/2&&t.Lt.Ht()):1>t.Lt.zt&&(a=1,-1>e?(t.Lt.Vt(),t.Lt.Gt()):e>1?(t.Lt.Ht(),t.Lt.Gt()):t.Lt.Et())}}),a||(i=r&&r.H?J(t,r):null,s=n?J(t,n):null,(h=null!==i&&null!==s?s>i?r:n:r&&r.H?r:n||null)&&(-.05>(e=N(t,h,!h.zt))?t.Lt.Vt():e>.05&&t.Lt.Ht(),e>-.1&&.1>e&&(h.zt||t.Lt.zt?t.Lt.Et():h===r&&180>i?(.1>Math.random()&&t.Lt.wt(),.02>Math.random()&&t.Lt.Gt(),.01>Math.random()&&t.Lt.Et()):t.Lt.Et())))}}(this):this.ni&&this.xi()}gi(t,i){if(this.game.tt){var s=this.game.tt.indexOf(this.Lt);s>-1&&this.game.tt.splice(s,1)}this.Lt=new D({Dt:1,x:t,y:i,q:this.q,kt:this.kt,game:this.game,Tt:this,W:1,scale:2,s(){this.N+=this.W}})}_i(){this.Lt=new D({x:20+Math.random()*(this.game.width-40),y:20+Math.random()*(this.game.height-40),q:this.q,kt:this.kt,game:this.game,Tt:this,s(){this.Kt()}}),this.game.tt.push(this.Lt),L.yt(),this.Lt.Qt=3}mi(t,i){this.di?(this.di.text=this.ui,this.di.k=this.ui>8?1.4:1):this.di={q:this.q,O:this.O,j:1,x:this.game.width/2+26*t-(i>2?13*Math.round(i/2)+(i/2>t?0:26*Math.round(i/2))-13:13),y:this.game.height/2+(i/2>t?-1:1)*(i>2?15:0),text:this.ui,scale:this.game.scale,k:this.ui>8?1.4:1},z(this.di)}}const E={red:"#f43",vi:"#f72",bi:"#ff0",green:"#2e1",blue:"#0bf",zi:"#45f",Ri:"#94f",Ai:"#f3b",ki:"#aad"};function G(t){var i,s=Object.values(E);do{i=s[s.length*Math.random()<<0]}while(game.pi.some(t=>t.q===i));return i}function K(t,i){if(!i)return G();if(i.includes("(L)")){if(!t.some(t=>t.q===E.blue))return E.blue;if(!t.some(t=>t.q===E.green))return E.green}if(i.includes("(R)")){if(!t.some(t=>t.q===E.red))return E.red;if(!t.some(t=>t.q===E.Ai))return E.Ai}return i.includes("Xbox")&&!t.some(t=>t.q===E.green)?E.green:G()}function Q(t,i,s){8!==t.pi.length&&(L.gt(),t.pi.push(new V({q:K(t.pi,s),kt:Math.floor(4*Math.random()),ni:i,ai:s,O:t.O,game:t})))}function W(t){var i=t.gamepad,s=window.gamepads[i.index]={id:i.id,S:{},axes:{x:0,y:0}};i.id.match(/2006|2007/)?s.B={a:1,b:0,x:3,y:2,l:4,r:5}:s.B={a:0,b:1,x:3,y:2,l:6,r:7},Q(window.game,"gamepad",i.id)}function Y(t){window.game.pi.some(i=>i.ni===t)||(Q(window.game,t),window.game.Si=window.game.Si.replace("("+t+")",""))}var $,tt,it;window.gamepads=[];let st=a({s(){m(),$.tt[0].N+=$.tt[0].W,$.pi.forEach((t,i)=>{if("ai"!==t.ni){if(t.keys.back()&&"gamepad"!==t.ni){if(t.oi.back--,0>=t.oi.back)return"gamepad"!==t.ni&&($.Si+="("+t.ni+")"),void $.pi.splice(i,1)}else t.oi.back=0;if(t.keys.hi()){if(t.oi.hi>0)return void t.oi.hi--;tt.T(),L.gt(),t.oi.hi=15}else t.oi.hi=0;if(t.keys.ei()){if(t.oi.ei>0)return void t.oi.ei--;tt.next(),L.gt(),t.oi.ei=15}else t.oi.ei=0;if(t.keys.ri()){if(t.oi.ri>0)return void t.oi.ri--;L.gt(),"p"===tt.Z[tt.F].text[0]?(st.stop(),it.Bi($,it)):"s"===tt.Z[tt.F].text[0]?($.k+=.25,1.5===$.k&&($.k=.75),p($),tt.Z[tt.F].text="scale "+100*$.k+"%",ht()):tt.Z[tt.F].text="credits - no room!",t.oi.ri=15}else t.oi.ri=0}})},h(){$.tt[0].h(2*$.scale),$.pi.length?(tt.h($.scale),$.pi.forEach((t,i)=>{z({C:1,text:"P"+(i+1)+" "+t.ni,q:t.q,k:.8,x:30,y:$.height-30-20*($.pi.length-1)+20*i,scale:$.scale,O:$.O})})):(z({P:1,C:1,text:"Press arrow keys,",k:.8,x:$.width-30,y:$.height-50,scale:$.scale,O:$.O}),z({P:1,C:1,text:"gamepad, or wasd/qzsd",k:.8,x:$.width-30,y:$.height-30,scale:$.scale,O:$.O})),z({P:1,text:"20461 Dioretsa",k:2*$.k,x:$.width-30,y:30,scale:$.scale,O:$.O})}});function ht(){$.tt.splice(0,1),Z({x:.4*$.width,y:.8*$.height,it:Math.min($.width/2,$.height/2),dx:0,dy:0,W:.05,rt:1,game:$})}function et(t,i){$=t,it=i,window.addEventListener("gamepadconnected",W),d([" ","ArrowUp","ArrowRight","ArrowDown","ArrowLeft"],()=>{Y("arrows")}),d(["w","a","s","d","z","q"],()=>{Y("wasd/zqsd")}),$.lt=[],$.yi=[],$.tt=[],tt=new R({O:$.O,x:30,y:30,Z:[{text:"play"},{text:"scale "+100*$.k+"%"},{text:"credits"}]}),ht(),st.start($,it)}var rt,nt;function at(t,i,s){let h=y=0,e=t%i,r=Math.floor(t/i)%i;return h=e*rt.width/i,y=r*rt.height/i,h+=e?s:2*s,y+=r?s:2*s,[h,y]}const ot=a({s(){if(m(),x("n")&&Q(rt,"ai"),x("m")){var t=null;rt.pi.forEach((i,s)=>{"ai"===i.ni&&(t=s)}),null!==t&&rt.pi.splice(t,1)}rt.pi.forEach((t,i)=>{if(t.Lt||t.gi(),"ai"!==t.ni){if(t.keys.ri()?(t.oi.ri--,t.oi.ri>0||(t.li=!t.li,L.gt(),t.oi.ri=15)):t.oi.ri=0,t.keys.back()?(t.oi.back--,t.oi.back>0||(ot.stop(),nt.Oi(rt,nt),L.gt(),t.oi.back=15)):t.oi.back=0,!t.li){if(t.Lt.N+=t.Lt.W,t.keys.hi()){if(t.oi.hi>0)return void t.oi.hi--;for(t.q=O(E,t.q);C(rt.pi,t);)t.q=O(E,t.q);rt.pi[i].Lt.q=t.q,L.gt(),t.oi.hi=15}else t.oi.hi=0;if(t.keys.ei()){if(t.oi.ei>0)return void t.oi.ei--;for(t.q=j(E,t.q);C(rt.pi,t);)t.q=j(E,t.q);rt.pi[i].Lt.q=t.q,L.gt(),t.oi.ei=15}else t.oi.ei=0;if(t.keys.left()){if(t.oi.left>0)return void t.oi.left--;t.kt=function(t,i){Object.values(t);let s=Object.keys(t),h=s.indexOf(i);return 0>--h?s[s.length-1]:s[h]}(F,t.kt),t.gi(),L.gt(),t.oi.left=15}else t.oi.left=0;if(t.keys.right()){if(t.oi.right>0)return void t.oi.right--;t.kt=function(t,i){Object.values(t);let s=Object.keys(t),h=s.indexOf(i);return h++==s.length-1?s[0]:s[h]}(F,t.kt),t.gi(),L.gt(),t.oi.right=15}else t.oi.right=0}}else t.li=1}),rt.pi.length>1&&rt.pi.every(t=>t.li)&&(ot.stop(),nt.ji(rt,nt))},h(){let t=rt.pi.length>4?3:2;rt.pi.forEach((i,s)=>{let[h,e]=at(s,t,4);rt.O.save(),rt.O.scale(rt.scale,rt.scale),rt.O.clearRect(h,e,rt.width/t-12,rt.height/t-12),rt.O.strokeStyle=i.q,rt.O.strokeRect(h,e,rt.width/t-12,rt.height/t-12),rt.O.restore(),z({text:"player "+(s+1),q:i.q,k:.8,x:h+12,y:e+12,scale:rt.scale,O:rt.O}),z({C:1,text:i.ai?i.ai:i.ni,q:i.q,k:.5,x:h+12,y:e+rt.height/t-20,scale:rt.scale,O:rt.O}),"ai"===i.ni&&z({C:1,text:"(m) remove",q:i.q,k:.5,x:h+30,y:e+rt.height/t-20,scale:rt.scale,O:rt.O}),z({P:1,C:1,text:i.li?"ready!":"selecting",q:i.q,k:.8,x:h+rt.width/t-22,y:e+rt.height/t-20,scale:rt.scale,O:rt.O}),i.Lt&&i.Lt.$t(rt.scale,h+rt.width/t-80,e+(rt.height/t-12)/2)});for(let i=rt.pi.length;4>i;i++){let[s,h]=at(i,t,4);z({text:"(n) add ai player",j:1,k:.5,x:s+rt.width/(2*t),y:h+rt.height/(2*t)-8,scale:rt.scale,O:rt.O}),z({text:rt.Si+" add player",j:1,k:.5,x:s+rt.width/(2*t),y:h+rt.height/(2*t)+8,scale:rt.scale,O:rt.O})}}}),lt=[];class ct{constructor(){this.Ci=null,this.Pi=1,this.qi=null,this.Zi=null,this.Fi=0,this.Ti=0,this.Li=0,this.Di=0,this.Ui=0}static Ii(){return lt.length?lt.pop():new ct}static Ji(t){lt.push(t)}static Ni(t,i){return t.sort>i.sort?-1:1}}class ut{constructor(){this.Xi=null,this.Hi=[],this.Vi=[]}Ei(t,i=0){i||(t.Gi,t.Gi=this,this.Hi.push(t));const s=t.Ki,h=t.x,e=t.y;s&&(t.Qi||t.x!==t.u||t.y!==t.M||t.Y!==t.Wi||t.Yi!==t.$i||t.ts!==t.ss)&&t.hs();const r=t.es,n=s?0:t.it*t.scale,a=(s?t.rs:h-n)-r,o=(s?t.ns:e-n)-r,l=(s?t.as:h+n)+r,c=(s?t.os:e+n)+r;t.Ti=a,t.Li=o,t.Di=l,t.Ui=c;let u=this.Xi,f=0;if(u)for(;;){if(!u.Pi){const i=u.Ci,s=u.Ti,h=u.Li,e=u.Di,r=u.Ui,n=u.Ci=t.Ci=ct.Ii();n.Ci=i,n.qi=u,n.Zi=t,n.Fi=f++,n.Ti=s>a?a:s,n.Li=h>o?o:h,n.Di=l>e?l:e,n.Ui=c>r?c:r,i?i.qi===u?i.qi=n:i.Zi=n:this.Xi=n;break}{const t=u.qi,i=t.Li,s=t.Di,h=t.Ui,e=a<t.Ti?a:t.Ti,r=i>o?o:i,n=l>s?l:s,d=c>h?c:h,x=(n-e)*(d-r)-(s-t.Ti)*(h-i),M=u.Zi,p=M.Ti,y=M.Li,w=M.Di,g=M.Ui,_=p>a?a:p,m=y>o?o:y,v=l>w?l:w,b=c>g?c:g,z=(v-_)*(b-m)-(w-p)*(g-y);u.Fi=f++,u.Ti=_>e?e:_,u.Li=m>r?r:m,u.Di=n>v?n:v,u.Ui=d>b?d:b,u=x>z?M:t}}else this.Xi=t}remove(t,i=0){if(i||(t.Gi,t.Gi=null,this.Hi.splice(this.Hi.indexOf(t),1)),this.Xi===t)return void(this.Xi=null);const s=t.Ci,h=s.Ci,e=s.qi,r=e===t?s.Zi:e;if(r.Ci=h,r.Pi&&(r.Fi=s.Fi),h){h.qi===s?h.qi=r:h.Zi=r;let t=h;for(;t;){const i=t.qi,s=i.Ti,h=i.Li,e=i.Di,r=i.Ui,n=t.Zi,a=n.Ti,o=n.Li,l=n.Di,c=n.Ui;t.Ti=a>s?s:a,t.Li=o>h?h:o,t.Di=e>l?e:l,t.Ui=r>c?r:c,t=t.Ci}}else this.Xi=r;ct.Ji(s)}s(){const t=this.Hi,i=t.length;for(let s=0;i>s;++s){const i=t[s];let h=0;if(h||i.ls===i.es||(i.es=i.ls,h=1),!h){const t=i.Ki;t&&(i.Qi||i.x!==i.u||i.y!==i.M||i.Y!==i.Wi||i.Yi!==i.$i||i.ts!==i.ss)&&i.hs();const s=i.x,e=i.y,r=t?0:i.it*i.scale,n=t?i.rs:s-r,a=t?i.ns:e-r,o=t?i.as:s+r,l=t?i.os:e+r;h=n<i.Ti||a<i.Li||o>i.Di||l>i.Ui}h&&(this.remove(i,1),this.Ei(i,1))}}cs(t){const i=[],s=t.Ti,h=t.Li,e=t.Di,r=t.Ui;let n=this.Xi,a=1;if(!n||!n.Pi)return i;for(;n;){if(a){a=0;let t=n.Pi?n.qi:null;for(;t&&t.Di>=s&&t.Ui>=h&&t.Ti<=e&&t.Li<=r;)t=(n=t).Pi?n.qi:null}const o=n.Pi,l=o?n.Zi:null;if(l&&l.Di>s&&l.Ui>h&&l.Ti<e&&l.Li<r)n=l,a=1;else{o||n===t||i.push(n);let s=n.Ci;if(!s)break;for(;s&&s.Zi===n;)s=(n=s).Ci;n=s}}return i}us(t){const i=this.Hi,s=i.length;for(let h=0;s>h;++h)i[h].us(t)}fs(t){let i=this.Xi,s=1;for(;i;){if(s){s=0;let t=i.Pi?i.qi:null;for(;t;)t=(i=t).Pi?i.qi:null}const h=i.Pi,e=i.Ti,r=i.Li,n=i.Di,a=i.Ui,o=h?i.Zi:null;if(t.moveTo(e,r),t.lineTo(n,r),t.lineTo(n,a),t.lineTo(e,a),t.lineTo(e,r),o)i=o,s=1;else{let t=i.Ci;if(!t)break;for(;t&&t.Zi===i;)t=(i=t).Ci;i=t}}}}class ft{constructor(){this.ds=0,this.a=null,this.b=null,this.xs=0,this.xs=0,this.Ms=0,this.ps=0,this.ys=0}}function dt(t,i,s=null,h=1){const e=t.Ki,r=i.Ki;let n=0;return s&&(s.a=t,s.b=i,s.xs=1,s.ws=1,s.Ms=null,s.ps=0,s.ys=0),e&&(t.Qi||t.x!==t.u||t.y!==t.M||t.Y!==t.Wi||t.Yi!==t.$i||t.ts!==t.ss)&&t.hs(),r&&(i.Qi||i.x!==i.u||i.y!==i.M||i.Y!==i.Wi||i.Yi!==i.$i||i.ts!==i.ss)&&i.hs(),h&&!function(t,i){const s=t.Ki,h=s?0:t.x,e=s?0:t.y,r=s?0:t.it*t.scale,n=s?t.rs:h-r,a=s?t.ns:e-r,o=s?t.as:h+r,l=s?t.os:e+r,c=i.Ki,u=c?0:i.x,f=c?0:i.y,d=c?0:i.it*i.scale,x=c?i.rs:u-d,M=c?i.ns:f-d,p=c?i.as:u+d,y=c?i.os:f+d;return p>n&&y>a&&o>x&&l>M}(t,i)||(e&&t.gs&&t._s(),r&&i.gs&&i._s(),n=e&&r?function(t,i,s=null){const h=t.ms.length,e=i.ms.length;if(2===h&&2===e){const h=t.ms,e=i.ms;return s&&(s.Ms=0),h[0]===e[0]&&h[1]===e[1]}const r=t.ms,n=i.ms,a=t.vs,o=i.vs;if(h>2)for(let t=0,i=1;h>t;t+=2,i+=2)if(Mt(r,n,a[t],a[i],s))return 0;if(e>2)for(let t=0,i=1;e>t;t+=2,i+=2)if(Mt(r,n,o[t],o[i],s))return 0;return 1}(t,i,s):e?xt(t,i,s,0):r?xt(i,t,s,1):function(t,i,s=null){const h=t.it*t.scale,e=i.it*i.scale,r=i.x-t.x,n=i.y-t.y,a=h+e,o=r*r+n*n;if(o>a*a)return 0;if(s){const t=Math.sqrt(o);s.xs=e>=h&&e-h>=t,s.ws=h>=e&&h-e>=t,s.Ms=a-t,s.ps=r/t,s.ys=n/t}return 1}(t,i,s)),s&&(s.ds=n),n}function xt(t,i,s=null,h=0){const e=t.ms,r=t.bs,n=t.vs,a=i.x,o=i.y,l=i.it*i.scale,c=2*l,u=l*l,f=e.length;let d=1,x=1,M=null,p=0,y=0;if(2===f){const t=a-e[0],i=o-e[1],h=t*t+i*i;if(h>u)return 0;if(s){const s=Math.sqrt(h);M=l-s,p=t/s,y=i/s,x=0}}else for(let t=0,i=1;f>t;t+=2,i+=2){const h=a-e[t],w=o-e[i],g=r[t],_=r[i],m=h*g+w*_,v=0>m?-1:m>g*g+_*_?1:0;let b=0,z=0,R=0,A=0;if(s&&d&&h*h+w*w>u&&(d=0),v){const i=-1===v,n=i?0===t?f-2:t-2:t===f-2?0:t+2,c=n+1,d=a-e[n],M=o-e[c],p=r[n],y=r[c],g=d*p+M*y;if((0>g?-1:g>p*p+y*y?1:0)==-v){const t=i?h:d,e=i?w:M,r=t*t+e*e;if(r>u)return 0;if(s){const i=Math.sqrt(r);b=1,z=l-i,R=t/i,A=e/i,x=0}}}else{const e=n[t],r=n[i],a=h*e+w*r,o=0>a?-a:a;if(a>0&&o>l)return 0;s&&(b=1,z=l-a,R=e,A=r,(x&&a>=0||c>z)&&(x=0))}b&&(null===M||M>z)&&(M=z,p=R,y=A)}return s&&(s.xs=h?x:d,s.ws=h?d:x,s.Ms=M,s.ps=h?-p:p,s.ys=h?-y:y),1}function Mt(t,i,s,h,e=null){const r=t.length,n=i.length;if(!r||!n)return 1;let a=null,o=null,l=null,c=null;for(let i=0,e=1;r>i;i+=2,e+=2){const r=t[i]*s+t[e]*h;(null===a||a>r)&&(a=r),(null===o||r>o)&&(o=r)}for(let t=0,e=1;n>t;t+=2,e+=2){const r=i[t]*s+i[e]*h;(null===l||l>r)&&(l=r),(null===c||r>c)&&(c=r)}if(a>c||l>o)return 1;if(e){let t=0;if(l>a)if(e.xs=0,c>o)t=o-l,e.ws=0;else{const i=o-l,s=c-a;t=s>i?i:-s}else if(e.ws=0,o>c)t=a-c,e.xs=0;else{const i=o-l,s=c-a;t=s>i?i:-s}const i=e.Ms,r=0>t?-t:t;if(null===i||i>r){const i=0>t?-1:1;e.Ms=r,e.ps=s*i,e.ys=h*i}}return 0}class pt{constructor(t=0,i=0,s=0){this.x=t,this.y=i,this.ls=s,this.zs=0,this.Ki=0,this.Rs=0,this.Gi=null,this.Ci=null,this.Pi=0,this.es=s,this.Ti=0,this.Li=0,this.Di=0,this.Ui=0}As(t,i=null,s=1){return dt(this,t,i,s)}cs(){return this.Gi.cs(this)}remove(){const t=this.Gi;t&&t.remove(this,0)}ks(){return new ft}static ks(){return new ft}}class yt extends pt{constructor(t=0,i=0,s=0,h=1,e=0){super(t,i,e),this.it=s,this.scale=h}us(t){const i=this.x,s=this.y,h=this.it*this.scale;t.moveTo(i+h,s),t.arc(i,s,h,0,2*Math.PI)}}class wt extends pt{constructor(t=0,i=0,s=[],h=0,e=1,r=1,n=0){super(t,i,n),this.Y=h,this.Yi=e,this.ts=r,this.Ki=1,this.u=t,this.M=i,this.Wi=h,this.$i=e,this.ss=r,this.rs=0,this.ns=0,this.as=0,this.os=0,this.Ss=null,this.ms=null,this.bs=null,this.vs=null,this.Qi=1,this.gs=1,wt.prototype.Bs.call(this,s)}us(t){(this.Qi||this.x!==this.u||this.y!==this.M||this.Y!==this.Wi||this.Yi!==this.$i||this.ts!==this.ss)&&this.hs();const i=this.ms;if(2===i.length)t.moveTo(i[0],i[1]),t.arc(i[0],i[1],1,0,2*Math.PI);else{t.moveTo(i[0],i[1]);for(let s=2;s<i.length;s+=2)t.lineTo(i[s],i[s+1]);i.length>4&&t.lineTo(i[0],i[1])}}Bs(t){const i=t.length;this.Ss=new Float64Array(2*i),this.ms=new Float64Array(2*i),this.bs=new Float64Array(2*i),this.vs=new Float64Array(2*i);const s=this.Ss;for(let h=0,e=0,r=1;i>h;++h,e+=2,r+=2){const i=t[h];s[e]=i[0],s[r]=i[1]}this.Qi=1}hs(){const t=this.x,i=this.y,s=this.Y,h=this.Yi,e=this.ts,r=this.Ss,n=this.ms,a=r.length;let o,l,c,u;for(let f=0,d=1;a>f;f+=2,d+=2){let a=r[f]*h,x=r[d]*e;if(s){const t=Math.cos(s),i=Math.sin(s),h=a;a=h*t-x*i,x=h*i+x*t}a+=t,x+=i,n[f]=a,n[d]=x,0===f?(o=l=a,c=u=x):(o>a?o=a:a>l&&(l=a),c>x?c=x:x>u&&(u=x))}this.u=t,this.M=i,this.Wi=s,this.$i=h,this.ss=e,this.rs=o,this.ns=c,this.as=l,this.os=u,this.Qi=0,this.gs=1}_s(){const t=this.ms,i=this.bs,s=this.vs,h=t.length;for(let e=0,r=1;h>e;e+=2,r+=2){const n=h>e+2?e+2:0,a=t[n]-t[e],o=t[n+1]-t[r],l=a||o?Math.sqrt(a*a+o*o):0;i[e]=a,i[r]=o,s[e]=l?o/l:0,s[r]=l?-a/l:0}this.gs=0}}class gt extends wt{constructor(t=0,i=0,s=0){super(t,i,[[0,0]],0,1,1,s),this.Rs=1}}gt.prototype.Bs=void 0;class _t{constructor(){this.Gi=new ut}ot(t=0,i=0,s=0,h=1,e=0){const r=new yt(t,i,s,h,e);return this.Gi.Ei(r),r}G(t=0,i=0,s=[[0,0]],h=0,e=1,r=1,n=0){const a=new wt(t,i,s,h,e,r,n);return this.Gi.Ei(a),a}Os(t=0,i=0,s=0){const h=new gt(t,i,s);return this.Gi.Ei(h),h}ks(){return new ft}static ks(){return new ft}Ei(...t){for(const i of t)this.Gi.Ei(i,0);return this}remove(...t){for(const i of t)this.Gi.remove(i,0);return this}s(){return this.Gi.s(),this}us(t){return this.Gi.us(t)}fs(t){return this.Gi.fs(t)}cs(t){return this.Gi.cs(t)}As(t,i,s=null,h=1){return dt(t,i,s,h)}}function mt(t,i,s){t.st>1e4?(i.x+=s.Ms*s.ps,i.y+=s.Ms*s.ys):i.st>1e4?(t.x-=s.Ms*s.ps,t.y-=s.Ms*s.ys):(t.x-=s.Ms*s.ps/2,t.y-=s.Ms*s.ys/2,i.x+=s.Ms*s.ps/2,i.y+=s.Ms*s.ys/2);var h=function(t){const i=U(t);return{x:t.x/i,y:t.y/i}}({x:s.ps,y:s.ys}),e={x:-h.y,y:h.x},r=I(t.I,e),n=I(i.I,e),a=I(t.I,h),o=I(i.I,h),l=(a*(t.st-i.st)+2*i.st*o)/(t.st+i.st),c=(o*(i.st-t.st)+2*t.st*a)/(t.st+i.st);1e4>t.st&&(t.dx=e.x*r+h.x*l,t.dy=e.y*r+h.y*l),1e4>i.st&&(i.dx=e.x*n+h.x*c,i.dy=e.y*n+h.y*c),t.js=i.js=1}function vt(t,i,s,h){if(4!==i.type){if(1===t.type){if(0===i.type){if(t.V.As(i.V,s))if(i.X=0,1e4>t.st&&t.it>8){for(var e=0;3>e;e++)Z({x:t.x,y:t.y,it:t.it/1.8,game:t.game});t.X=0,L.pt()}else if(t.st>1e4)for(e=0;3>e;e++)t.game.tt.push(new k({X:60*Math.random(),x:i.x+s.Ms*s.ps,y:i.y+s.Ms*s.ys,dx:s.ps+Math.random()-.5,dy:s.ys+Math.random()-.5,s(t){this.I=this.I.add(this.J,t),this.U=this.U.add(this.I,t),this.X--},h(t){this.O.save(),this.O.scale(t,t),this.O.translate(this.x,this.y),this.O.fillStyle="#fff",this.O.beginPath(),this.O.arc(0,0,1,0,2*Math.PI),this.O.fill(),this.O.restore()}}));else t.et(h),L.pt();return}if(1===i.type){if(t.js||i.js)return;return void(t.V.As(i.V,s)&&mt(t,i,s))}if(2===i.type){if(t.js||i.js)return;return void(t.V.As(i.V,s)&&mt(t,i,s))}}if(t.type,3===t.type){if(0===i.type){if(i.$===t)return;if(t.V.As(i.V,s)){if(i.$.Tt.fi++,i.X=0,t.zt)return;if(t.Qt)return;if(t.It)return void(t.Jt=t.Jt||60);t.et(h),i.$.Tt.ui++,L.Rt()}return}if(1===i.type){if(t.V.As(i.V,s)){if(t.Qt)return t.x-=s.Ms*s.ps,void(t.y-=s.Ms*s.ys);if(t.It)return t.Jt=t.Jt||60,t.x-=s.Ms*s.ps,void(t.y-=s.Ms*s.ys);if(t.zt){if(1e4>i.st&&i.it>8){for(e=0;3>e;e++)Z({x:i.x,y:i.y,it:i.it/1.8,lt:i,game:i.game});i.X=0,L.pt()}else i.st>1e4?(t.x-=s.Ms*s.ps,t.y-=s.Ms*s.ys):(i.et(h),L.pt());return}if(.3>B(t.I)&&.3>B(i.I))return t.x-=s.Ms*s.ps,void(t.y-=s.Ms*s.ys);t.et(h),t.Tt.ci++}return}if(2===i.type)return void(t.V.As(i.V,s)&&(i.Cs(t),L.At(),i.X=0));if(3===i.type){if(i.Pt)return;if(t.V.As(i.V,s)){if(t.zt&&!i.Qt)return t.It?(i.x+=s.Ms*s.ps,void(i.y+=s.Ms*s.ys)):i.It?(i.Jt=i.Jt||60,i.x+=s.Ms*s.ps,void(i.y+=s.Ms*s.ys)):(i.et(),t.Tt.ui++,void L.Rt());i.x+=s.Ms*s.ps,i.y+=s.Ms*s.ys}return}}}else t.V.As(i.V,s)&&(i.x+=s.Ms*s.ps,i.y+=s.Ms*s.ys)}class bt extends k.A{constructor(t){super(t),this.q=t.q||"#fff",this.type=2,this.it=5,this.st=3e3,this.x=t.x,this.y=t.y,this.dx=Math.random()-.5,this.dy=Math.random()-.5,this.W=.5>Math.random()?-1:1,this.V=t.game.K.ot(t.x,t.y,this.it),this.V.$=this,this.Ps=0}s(t){this.N+=this.W,this.U=this.U.add(this.I),this.V.x=this.x,this.V.y=this.y,this.Ps%10&&(this.q="hsl("+this.Ps+",100%,60%)"),this.Ps++}h(t){this.O.save(),this.O.scale(t,t),this.O.translate(this.x,this.y),this.O.rotate(S(this.N)),this.O.beginPath(),this.O.strokeStyle=this.q,this.O.arc(0,0,this.it,0,2*Math.PI),this.O.stroke(),this.O.restore()}}class zt extends bt{constructor(t){super(t)}s(){super.s()}Cs(t){t.Bt=2*t.ft}h(t){this.O.save(),this.O.scale(t,t),this.O.translate(this.x,this.y),this.O.rotate(S(this.N)),this.O.beginPath(),this.O.strokeStyle="#fff",this.O.rect(Math.sqrt(.4*Math.pow(this.it,2)),Math.sqrt(.4*Math.pow(this.it,2)),-2*Math.sqrt(.4*Math.pow(this.it,2)),-2*Math.sqrt(.4*Math.pow(this.it,2))),this.O.stroke(),this.O.beginPath(),this.O.strokeStyle="#0ef",this.O.rect(-1.35,-1.35,.45,.45),this.O.rect(.9,-1.35,.45,.45),this.O.rect(-1.35,.9,.45,.45),this.O.rect(.9,.9,.45,.45),this.O.stroke(),this.O.restore(),super.h(t)}}class Rt extends bt{constructor(t){super(t)}s(){super.s()}Cs(t){t.Ut()}h(t){this.O.save(),this.O.scale(t,t),this.O.translate(this.x,this.y),this.O.rotate(S(this.N)),this.O.beginPath(),this.O.strokeStyle="#fff",this.O.rect(Math.sqrt(.4*Math.pow(this.it,2)),Math.sqrt(.4*Math.pow(this.it,2)),-2*Math.sqrt(.4*Math.pow(this.it,2)),-2*Math.sqrt(.4*Math.pow(this.it,2))),this.O.stroke(),this.O.beginPath(),this.O.arc(0,0,this.it/2-1,0,2*Math.PI),this.O.stroke(),this.O.restore(),super.h(t)}}class At extends bt{constructor(t){super(t)}s(){super.s()}Cs(t){t.zt+=8,t.dt=(t.St.dt+6)/9}h(t){this.O.save(),this.O.scale(t,t),this.O.translate(this.x,this.y),this.O.rotate(S(this.N)),this.O.beginPath(),this.O.strokeStyle="#fff";var i=Math.PI/2*3,s=Math.PI/5;this.O.moveTo(0,0-.75*this.it);for(let t=0;5>t;t++)this.O.lineTo(Math.cos(i)*this.it*.75,Math.sin(i)*this.it*.75),i+=s,this.O.lineTo(Math.cos(i)*this.it*.35,Math.sin(i)*this.it*.35),i+=s;this.O.lineTo(0,0-.75*this.it),this.O.closePath(),this.O.stroke(),this.O.restore(),super.h(t)}}var kt;const St=a({s(){if(m(),Bt.Mi&&(Bt.Mi++,Bt.pi.forEach(t=>{"ai"!==t.ni?t.keys.ri()&&Bt.Mi>60?(t.oi.ri--,t.oi.ri>0||(t.li=!t.li,t.oi.ri=15)):t.oi.ri=0:t.li=0}),Bt.pi.every(t=>!t.li)&&(St.stop(),kt.Oi(Bt,kt))),Bt.pi.forEach(t=>{t.s()}),Bt.tt.map(t=>{t.s(),0!==t.type&&(t.x>Bt.width?t.x=0:0>t.x&&(t.x=Bt.width),t.y>Bt.height?t.y=0:0>t.y&&(t.y=Bt.height))}),function({tt:t,K:i,qs:s}){var h={};i.s(),t.forEach(i=>{if(i.V&&!i.Pt&&(h=i.V.cs()))for(let e of h)vt(i,e.$,s,t)}),t.forEach(t=>{t.js=0})}(Bt),Bt.tt.forEach(t=>{t.H()&&!t.Wt||t.V&&t.V.remove()}),Bt.tt=Bt.tt.filter(t=>t.H()),Bt.lt=Bt.lt.filter(t=>t.H()),Bt.yi=Bt.yi.filter(t=>t.H()),Bt.tt=Bt.tt.filter(t=>!t.Wt),Bt.Mi||Bt.pi.forEach(t=>{t.Lt.Wt&&t.Lt.X&&(t.Lt={},setTimeout(()=>{t._i()},3e3)),t.ui>9&&(Bt.Mi=1,Bt.Zs=[],Bt.pi.forEach(t=>{Bt.Zs.push(t)}),Bt.Zs.sort((t,i)=>t.ui>i.ui?-1:t.ui<i.ui?1:t.Yt<i.Yt?-1:t.Yt>i.Yt?1:Math.round(.5>Math.random()?-1:1)),Bt.Zs.forEach((t,i)=>{t.Fs=i}))}),5>Bt.lt.length&&.005>Math.random()&&Z({x:Math.random()*Bt.width,y:Math.random()*Bt.height,it:20,game:Bt}),1>Bt.yi.length){let t=Math.random(),i=null;t>0&&.001>t&&(i=new zt({x:Math.random()*Bt.width,y:Math.random()*Bt.height,game:Bt})),t>.001&&.002>t&&(i=new Rt({x:Math.random()*Bt.width,y:Math.random()*Bt.height,game:Bt})),t>.002&&.0027>t&&(i=new At({x:Math.random()*Bt.width,y:Math.random()*Bt.height,game:Bt})),i&&(Bt.tt.push(i),Bt.yi.push(i))}},h(){Bt.tt.map(t=>t.h(Bt.scale)),Bt.Mi?function(t){var i=t.k*t.k*t.k*t.k*32,s=t.width-2*i,h=i+7,e=s/t.pi.length-14,r=t.height-2*(i+7);t.pi.length>2&&(r=r/2-7,e=s/Math.round(t.pi.length/2)-14),t.pi.forEach((n,a)=>{var o=i+(e+14)*a+7;t.pi.length>2&&a>=t.pi.length/2&&(h=i+21+r,o-=s),t.O.save(),t.O.scale(t.scale,t.scale),t.O.clearRect(o,h,e,r),t.O.strokeStyle=n.q,t.O.strokeRect(o,h,e,r),t.O.restore(),0===n.Fs?(z({text:"winner!",q:n.q,x:o+7,y:h+7+1,k:1.35*t.k,scale:t.scale,O:t.O}),t.O.save(),t.O.scale(t.scale,t.scale),t.O.strokeStyle=n.q,t.O.strokeRect(o-6,h-6,e+12,r+12),t.O.strokeRect(o-3,h-3,e+6,r+6),t.O.restore()):(z({text:n.Fs+1,q:n.q,x:o+7,y:h+7+1,k:1.3*t.k,scale:t.scale,O:t.O}),1===n.Fs?z({text:"nd",q:n.q,x:o+7+17*t.k,y:h+7+12*t.k,k:.5,scale:t.scale,O:t.O}):2===n.Fs?z({text:"rd",q:n.q,x:o+7+17*t.k,y:h+7+11*t.k,k:.5,scale:t.scale,O:t.O}):z({text:"th",q:n.q,x:o+7+17*t.k,y:h+7+12*t.k,k:.5,scale:t.scale,O:t.O})),z({text:"player "+(a+1),q:n.q,k:.8,x:o+7,y:h+40,scale:t.scale,O:t.O}),z({text:"score",q:n.q,k:.5,x:o+7,y:h+65,scale:t.scale,O:t.O}),z({text:n.ui,q:n.q,k:.6,P:1,x:o+e-7,y:h+65,scale:t.scale,O:t.O}),z({text:"deaths",q:n.q,k:.5,x:o+7,y:h+80,scale:t.scale,O:t.O}),z({text:n.Yt,q:n.q,k:.6,P:1,x:o+e-7,y:h+80,scale:t.scale,O:t.O}),z({text:"accuracy",q:n.q,k:.5,x:o+7,y:h+95,scale:t.scale,O:t.O}),z({text:(n.Xt&&n.fi?Math.round(100/n.Xt*n.fi):0)+"%",q:n.q,k:.6,P:1,x:o+e-7,y:h+95,scale:t.scale,O:t.O}),z({text:"crashes",q:n.q,k:.5,x:o+7,y:h+110,scale:t.scale,O:t.O}),z({text:n.ci,q:n.q,k:.6,P:1,x:o+e-7,y:h+110,scale:t.scale,O:t.O}),z({text:n.li?"next>":"ready!",q:n.q,k:1.2*t.k,P:1,C:1,x:o+e-7,y:h+r-7,scale:t.scale,O:t.O})})}(Bt):Bt.pi.map((t,i)=>t.mi(i,Bt.pi.length))}});var Bt;let{canvas:Ot,context:jt}=(t=document.querySelector("canvas"),(i=t.getContext("2d")).Ts=0,h("init"),{canvas:t,context:i});const Ct={canvas:Ot,O:jt,pi:[]},Pt={Oi:et,Bi:function(t,i){nt=i,(rt=t).pi.forEach(t=>{t.Lt=null,t.reset()}),ot.start()},ji:function(t,i){Bt=t,kt=i,window.removeEventListener("gamepadconnected",W),c={},Bt.lt=[],Bt.yi=[],Bt.tt=[],Bt.Mi=0,Bt.K=new _t,Bt.qs=Bt.K.ks(),Z({x:Bt.width/2,y:Bt.height/2,it:Math.min(Bt.width/5,Bt.height/5),st:1e5,dx:0,dy:0,W:.1,game:Bt}),Bt.pi.forEach(t=>{t._i()}),St.start()}};window.game=Ct,window.addEventListener("keydown",function(t){t.repeat||(u[t.key]=1,f[t.key]=1,c[t.key]&&c[t.key](t))}),window.addEventListener("keyup",function(t){f[t.key]=0}),Ot.style="width:100%;background:#000",p(Ct),window.onresize=()=>{p(Ct)},Ct.Si="(gamepad)(wasd/zqsd)(arrows)",et(Ct,Pt)</script>